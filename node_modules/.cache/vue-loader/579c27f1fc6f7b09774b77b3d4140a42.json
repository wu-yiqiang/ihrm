{"remainingRequest":"C:\\Users\\windows\\project\\ihrm\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\windows\\project\\ihrm\\src\\views\\departments\\components\\add-dept.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\windows\\project\\ihrm\\src\\views\\departments\\components\\add-dept.vue","mtime":1616652815904},{"path":"C:\\Users\\windows\\project\\ihrm\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\windows\\project\\ihrm\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\windows\\project\\ihrm\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\windows\\project\\ihrm\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQovLyDov5nph4zlj6/ku6Xlr7zlhaXlhbbku5bmlofku7bvvIjmr5TlpoLvvJrnu4Tku7bvvIzlt6Xlhbdqc++8jOesrOS4ieaWueaPkuS7tmpz77yManNvbuaWh+S7tu+8jOWbvueJh+aWh+S7tuetieetie+8iQ0KaW1wb3J0IHthZGREZXBhcnRtZW50cywgZ2V0RGVwYXJ0bWVudHMsZ2V0RGVwYXJ0bWVudHNEZXRhaWwsdXBkYXRlRGVwYXJ0bWVudHN9IGZyb20gJ0AvYXBpL2RlcGFydG1lbnRzLmpzJw0KaW1wb3J0IHtnZXRFbXBsb3llZXNMaXN0fSBmcm9tICdAL2FwaS9lbXBsb3llZXMnDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICdhZGREZXB0JywNCiAgY29tcG9uZW50czoge30sDQogIG1vZGVsOiB7fSwgLy8g5a6a5LmJ5bGe5oCnDQogIHByb3BzOiB7DQogICAgc2hvd0RpYWxvZzogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlDQogICAgfSwNCiAgICB0cmVlTm9kZTogew0KICAgICAgdHlwZTogT2JqZWN0LA0KICAgICAgZGVmYXVsdDogbnVsbA0KICAgIH0NCiAgfSwNCiAgZGF0YSAoKSB7DQogICAgY29uc3QgY2hlY2tOYW1lUmVwZWF0ID0gIGFzeW5jKHJ1bGUsdmFsdWUsY2FsbGJhY2spID0+IHsNCiAgICAgIGNvbnN0IHsgZGVwdHMgfSA9IGF3YWl0IGdldERlcGFydG1lbnRzKCkNCiAgICAgIGxldCBpc1JlcGVhdCA9IGZhbHNlDQogICAgIGlmKHRoaXMuZm9ybURhdGUuaWQpIHsNCiAgICAgICAvLyDnvJbovpHmqKHlvI8NCiAgICAgICBpc1JlcGVhdCAgPSBkZXB0cy5maWx0ZXIoaXRlbSA9PiBpdGVtLmlkPT09IHRoaXMudHJlZU5vZGUucGlkICYmIGl0ZW0uaWQgIT0gdGhpcy50cmVlTm9kZS5pZCkuc29tZShpdGVtID0+IGl0ZW0ubmFtZSA9PSB2YWx1ZSkNCiAgICAgfSBlbHNlIHsNCiAgICAgICAvLyDmlrDlop7mqKHlvI8NCiAgICAgICAgaXNSZXBlYXQgPSBkZXB0cy5maWx0ZXIoIGVsZW1lbnQgPT4gew0KICAgICAgICByZXR1cm4gZWxlbWVudC5waWQgPT10aGlzLnRyZWVOb2RlLnBpZA0KICAgICAgfSkuc29tZShpdGVtID0+IHsNCiAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZSA9PSB2YWx1ZSANCiAgICAgIH0pDQogICAgIH0NCiAgICAgIC8vIGNvbnNvbGUubG9nKCcqKirku6PnoIHosIPor5XkuK0qKioqKionLCBpc1JlcGVhdCkNCiAgICAgIGlzUmVwZWF0ID8gY2FsbGJhY2sobmV3IEVycm9yKGDlkIznuqfpg6jpl6jkuIvlt7LlrZjlnKgke3ZhbHVlfemDqOmXqGApKSA6IGNhbGxiYWNrKCkNCiAgICB9DQogICAgY29uc3QgY2hlY2tDb2RlUmVwZWF0ID0gYXN5bmMgKHJ1bGUsdmFsdWUsY2FsbGJhY2spID0+IHsNCiAgICAgIGNvbnN0IHsgZGVwdHMgfSA9IGF3YWl0IGdldERlcGFydG1lbnRzKCkNCiAgICAgIGxldCBpc1JlcGVhdCA9IGZhbHNlDQogICAgICBpZih0aGlzLmZvcm1EYXRlLmlkKSB7DQogICAgICAgIGlzUmVwZWF0ID0gZGVwdHMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5pZCAhPT0gdGhpcy50cmVlTm9kZS5pZCkuc29tZShpdGVtID0+IGl0ZW0uY29kZSA9PSB2YWx1ZSAmJiB2YWx1ZSkNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlzUmVwZWF0ID0gZGVwdHMuc29tZSggZWxlbWVudCA9PiB7DQogICAgICAgICAgcmV0dXJuIGVsZW1lbnQuY29kZSA9PSB2YWx1ZSAmJiB2YWx1ZQ0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgICAgaXNSZXBlYXQgPyBjYWxsYmFjayhuZXcgRXJyb3IoYCR7dmFsdWV96YOo6Zeo57yW56CB6YeN5aSNYCkpIDogY2FsbGJhY2soKQ0KICAgIH0NCiAgICByZXR1cm4gew0KICAgICAgZm9ybURhdGU6IHsNCiAgICAgICAgbmFtZTonJywNCiAgICAgICAgY29kZTonJywNCiAgICAgICAgbWFuYWdlcjogJycsDQogICAgICAgIGludHJvZHVjZToiIg0KICAgICAgfSwNCiAgICAgIHJ1bGVzOiB7DQogICAgICAgIG5hbWU6IFsNCiAgICAgICAgICB7cmVxdWlyZWQ6dHJ1ZSwgbWVzc2FnZTon6YOo6Zeo5ZCN56ew5LiN6IO95Li656m677yBJyx0cmlnZ2VyOidibHVyJ30sDQogICAgICAgICAge21pbjoxLG1heDo1MCxtZXNzYWdlOifplb/luqblv4XpobvlnKgxLTEwMOS4quWtl+espuS5i+mXtCcsdHJpZ2dlcjonYmx1cid9LA0KICAgICAgICAgIHt0cmlnZ2VyOidibHVyJyx2YWxpZGF0ZTpjaGVja05hbWVSZXBlYXR9DQogICAgICAgIF0sDQogICAgICAgIGNvZGU6IFsNCiAgICAgICAgICB7cmVxdWlyZWQ6dHJ1ZSwgbWVzc2FnZTon6YOo6Zeo57yW56CB5LiN6IO95Li656m677yBJyx0cmlnZ2VyOidibHVyJ30sDQogICAgICAgICAge21pbjoxLG1heDo1MCxtZXNzYWdlOifplb/luqblv4XpobvlnKgxLTEwMOS4quWtl+espuS5i+mXtCcsdHJpZ2dlcjonYmx1cid9LA0KICAgICAgICAgIHt0cmlnZ2VyOidibHVyJyx2YWxpZGF0ZTpjaGVja0NvZGVSZXBlYXR9DQogICAgICAgIF0sDQogICAgICAgIG1hbmFnZXI6IFsNCiAgICAgICAgICB7cmVxdWlyZWQ6dHJ1ZSwgbWVzc2FnZTon6YOo6Zeo566h55CG5ZGY5LiN6IO95Li656m677yBJyx0cmlnZ2VyOidibHVyJ30sDQogICAgICAgIF0sDQogICAgICAgIGludHJvZHVjZTogWw0KICAgICAgICAgIHtyZXF1aXJlZDp0cnVlLCBtZXNzYWdlOifpg6jpl6jku4vnu43kuI3og73kuLrnqbrvvIEnLHRyaWdnZXI6J2JsdXInfSwNCiAgICAgICAgICB7bWluOjEsbWF4OjEwMCxtZXNzYWdlOifplb/luqblv4XpobvlnKgxLTMwMOS4quWtl+espuS5i+mXtCcsdHJpZ2dlcjonYmx1cid9DQogICAgICAgIF0NCiAgICAgIH0sDQogICAgICBwZW9wbGVzOltdDQogICAgfQ0KICB9LA0KICBiZWZvcmVDcmVhdGUgKCkge30sIC8vIOeUn+WRveWRqOacnyAtIOWIm+W7uuS5i+WJjQ0KICBjcmVhdGVkICgpIHt9LCAvLyDnlJ/lkb3lkajmnJ8gLSDliJvlu7rlrozmiJDvvIjlj6/ku6Xorr/pl67lvZPliY10aGlz5a6e5L6L77yJDQogIGJlZm9yZU1vdW50ICgpIHt9LCAvLyDnlJ/lkb3lkajmnJ8gLSDmjILovb3kuYvliY0NCiAgbW91bnRlZCAoKSB7fSwgLy8g55Sf5ZG95ZGo5pyfIC0g5oyC6L295a6M5oiQ77yI5Y+v5Lul6K6/6ZeuRE9N5YWD57Sg77yJDQogIGNvbXB1dGVkOiB7DQogICAgc2hvd1RpdGxlKCkgew0KICAgICAgdGhpcy5mb3JtRGF0ZS5pZCA/ICfmlrDlop7pg6jpl6gnIDogJ+e8lui+kemDqOmXqCcNCiAgICB9DQogIH0sIC8vIOiuoeeul+WxnuaAp++8jOS8muebkeWQrOS+nei1luWxnuaAp+WAvOmaj+S5i+WPmOWMlg0KICB3YXRjaDoge30sIC8vIOebkeaOp2RhdGHkuK3nmoTmlbDmja7lj5jljJYNCiAgbWV0aG9kczogew0KICAgIC8qIOiOt+WPlui0n+i0o+S6uuaVsOaNruWIl+ihqCAqLw0KICAgIGFzeW5jIGdldEVtcGxveWVlc0xpc3QoKSB7DQogICAgICB0aGlzLnBlb3BsZXMgPSBhd2FpdCBnZXRFbXBsb3llZXNMaXN0KCkNCiAgICB9LA0KICAgIC8qIOWFqOWxgOagoemqjOi+k+WFpeahhiAqLw0KICAgIGJ0bk9rKCkgew0KICAgICAgdGhpcy4kcmVmcy5kZXB0Rm9ybS52YWxpZGF0ZShhc3luYyB2YWxpZGF0ZSA9PiB7DQogICAgICAgIGlmKHZhbGlkYXRlKSB7DQogICAgICAgICAgaWYodGhpcy5mb3JtRGF0ZS5pZCkgew0KICAgICAgICAgICAgLy8g57yW6L6RDQogICAgICAgICAgICBhd2FpdCB1cGRhdGVEZXBhcnRtZW50cyh0aGlzLmZvcm1EYXRlKQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyDmlrDlop4NCiAgICAgICAgICAgIGF3YWl0IGFkZERlcGFydG1lbnRzKHsuLi50aGlzLmZvcm1EYXRlLHBpZDp0aGlzLnRyZWVOb2RlLmlkfSkNCiAgICAgICAgICB9DQogICAgICAgICAgDQogICAgICAgICAgLy8g5riF6Zmk6L6T5YWl5qGG5YaF5a65DQogICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOnNob3dEaWFsb2cnLGZhbHNlKQ0KICAgICAgICAgIHRoaXMuJGVtaXQoJ2FkZERlcHRzJykNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIGJ0bkNhbmNlbCAoKSB7DQogICAgICB0aGlzLiRyZWZzLmRlcHRGb3JtLnZhbGlkYXRlRmllbGQoKQ0KICAgICAgdGhpcy5mb3JtRGF0ZSA9IHsNCiAgICAgICAgbmFtZTonJywNCiAgICAgICAgY29kZTonJywNCiAgICAgICAgbWFuYWdlcjogJycsDQogICAgICAgIGludHJvZHVjZToiIg0KICAgICAgfQ0KICAgICAgdGhpcy4kcmVmcy5kZXB0Rm9ybS5yZXNldEZpZWxkcygpDQogICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6c2hvd0RpYWxvZycsZmFsc2UpDQogICAgfSwNCiAgICAvKiDojrflj5blvZPliY3pg6jpl6jor6bmg4UgKi8NCiAgICBhc3luYyBnZXREZXBhcnRtZW50c0RldGFpbChpZCkgew0KICAgICAgdGhpcy5mb3JtRGF0ZSA9IGF3YWl0IGdldERlcGFydG1lbnRzRGV0YWlsKGlkKQ0KICAgIH0gDQogIH0sIC8vIOaWueazlembhuWQiA0KICBiZWZvcmVVcGRhdGUgKCkge30sIC8vIOeUn+WRveWRqOacnyAtIOabtOaWsOS5i+WJjQ0KICB1cGRhdGVkICgpIHt9LCAvLyDnlJ/lkb3lkajmnJ8gLSDmm7TmlrDkuYvlkI4NCiAgYmVmb3JlRGVzdHJveSAoKSB7fSwgLy8g55Sf5ZG95ZGo5pyfIC0g6ZSA5q+B5LmL5YmNDQogIGRlc3Ryb3llZCAoKSB7fSwgLy8g55Sf5ZG95ZGo5pyfIC0g6ZSA5q+B5a6M5oiQDQogIGFjdGl2YXRlZCAoKSB7fSAvLyDlpoLmnpzpobXpnaLmnIlrZWVwLWFsaXZl57yT5a2Y5Yqf6IO977yM6L+Z5Liq5Ye95pWw5Lya6Kem5Y+RDQp9DQo="},{"version":3,"sources":["add-dept.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add-dept.vue","sourceRoot":"src/views/departments/components","sourcesContent":["<template>\r\n  <el-dialog :title=\"showTitle\" :visible=\"showDialog\" width=\"30%\" @close=\"btnCancel\">  \r\n    <el-form  label-width=\"100px\" :model=\"formDate\" :rules=\"rules\" ref=\"deptForm\">\r\n      <el-form-item label=\"部门名称\" prop=\"name\">\r\n        <el-input v-model=\"formDate.name\" placeholder=\"1-50字符\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"部门编码\"  prop=\"code\">\r\n        <el-input v-model=\"formDate.code\" placeholder=\"1-50字符\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"部门负责人\"  prop=\"manager\">\r\n        <el-select v-model=\"formDate.manager\" placeholder=\"请选择\" style=\"width: 100%;\" @focus=\"getEmployeesList\">\r\n          <el-option v-for=\"item in peoples\" :key=\"item.id\" :label=\"item.username\" :value=\"item.username\"></el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"部门介绍\"  prop=\"introduce\">\r\n         <el-input type=\"textarea\" v-model=\"formDate.introduce\" placeholder=\"1-300字符\" rows=\"3\"></el-input>\r\n      </el-form-item>\r\n    </el-form>\r\n    <!-- 确定提交 -->\r\n    <el-row type=\"flex\" justify=\"center\" slot='footer'>\r\n      <el-col :span=\"6\">\r\n        <el-button  size=\"small\" @click=\"btnCancel\">取消</el-button>\r\n        <el-button  size=\"small\" type=\"primary\" @click=\"btnOk\">确定</el-button>\r\n      </el-col>\r\n    </el-row>\r\n    <!-- /确定提交 -->\r\n  </el-dialog>\r\n</template>\r\n\r\n<script>\r\n// 这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）\r\nimport {addDepartments, getDepartments,getDepartmentsDetail,updateDepartments} from '@/api/departments.js'\r\nimport {getEmployeesList} from '@/api/employees'\r\nexport default {\r\n  name: 'addDept',\r\n  components: {},\r\n  model: {}, // 定义属性\r\n  props: {\r\n    showDialog: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    treeNode: {\r\n      type: Object,\r\n      default: null\r\n    }\r\n  },\r\n  data () {\r\n    const checkNameRepeat =  async(rule,value,callback) => {\r\n      const { depts } = await getDepartments()\r\n      let isRepeat = false\r\n     if(this.formDate.id) {\r\n       // 编辑模式\r\n       isRepeat  = depts.filter(item => item.id=== this.treeNode.pid && item.id != this.treeNode.id).some(item => item.name == value)\r\n     } else {\r\n       // 新增模式\r\n        isRepeat = depts.filter( element => {\r\n        return element.pid ==this.treeNode.pid\r\n      }).some(item => {\r\n        return item.name == value \r\n      })\r\n     }\r\n      // console.log('***代码调试中******', isRepeat)\r\n      isRepeat ? callback(new Error(`同级部门下已存在${value}部门`)) : callback()\r\n    }\r\n    const checkCodeRepeat = async (rule,value,callback) => {\r\n      const { depts } = await getDepartments()\r\n      let isRepeat = false\r\n      if(this.formDate.id) {\r\n        isRepeat = depts.filter(item => item.id !== this.treeNode.id).some(item => item.code == value && value)\r\n      } else {\r\n        isRepeat = depts.some( element => {\r\n          return element.code == value && value\r\n        })\r\n      }\r\n      isRepeat ? callback(new Error(`${value}部门编码重复`)) : callback()\r\n    }\r\n    return {\r\n      formDate: {\r\n        name:'',\r\n        code:'',\r\n        manager: '',\r\n        introduce:\"\"\r\n      },\r\n      rules: {\r\n        name: [\r\n          {required:true, message:'部门名称不能为空！',trigger:'blur'},\r\n          {min:1,max:50,message:'长度必须在1-100个字符之间',trigger:'blur'},\r\n          {trigger:'blur',validate:checkNameRepeat}\r\n        ],\r\n        code: [\r\n          {required:true, message:'部门编码不能为空！',trigger:'blur'},\r\n          {min:1,max:50,message:'长度必须在1-100个字符之间',trigger:'blur'},\r\n          {trigger:'blur',validate:checkCodeRepeat}\r\n        ],\r\n        manager: [\r\n          {required:true, message:'部门管理员不能为空！',trigger:'blur'},\r\n        ],\r\n        introduce: [\r\n          {required:true, message:'部门介绍不能为空！',trigger:'blur'},\r\n          {min:1,max:100,message:'长度必须在1-300个字符之间',trigger:'blur'}\r\n        ]\r\n      },\r\n      peoples:[]\r\n    }\r\n  },\r\n  beforeCreate () {}, // 生命周期 - 创建之前\r\n  created () {}, // 生命周期 - 创建完成（可以访问当前this实例）\r\n  beforeMount () {}, // 生命周期 - 挂载之前\r\n  mounted () {}, // 生命周期 - 挂载完成（可以访问DOM元素）\r\n  computed: {\r\n    showTitle() {\r\n      this.formDate.id ? '新增部门' : '编辑部门'\r\n    }\r\n  }, // 计算属性，会监听依赖属性值随之变化\r\n  watch: {}, // 监控data中的数据变化\r\n  methods: {\r\n    /* 获取负责人数据列表 */\r\n    async getEmployeesList() {\r\n      this.peoples = await getEmployeesList()\r\n    },\r\n    /* 全局校验输入框 */\r\n    btnOk() {\r\n      this.$refs.deptForm.validate(async validate => {\r\n        if(validate) {\r\n          if(this.formDate.id) {\r\n            // 编辑\r\n            await updateDepartments(this.formDate)\r\n          } else {\r\n            // 新增\r\n            await addDepartments({...this.formDate,pid:this.treeNode.id})\r\n          }\r\n          \r\n          // 清除输入框内容\r\n          this.$emit('update:showDialog',false)\r\n          this.$emit('addDepts')\r\n        }\r\n      })\r\n    },\r\n    btnCancel () {\r\n      this.$refs.deptForm.validateField()\r\n      this.formDate = {\r\n        name:'',\r\n        code:'',\r\n        manager: '',\r\n        introduce:\"\"\r\n      }\r\n      this.$refs.deptForm.resetFields()\r\n      this.$emit('update:showDialog',false)\r\n    },\r\n    /* 获取当前部门详情 */\r\n    async getDepartmentsDetail(id) {\r\n      this.formDate = await getDepartmentsDetail(id)\r\n    } \r\n  }, // 方法集合\r\n  beforeUpdate () {}, // 生命周期 - 更新之前\r\n  updated () {}, // 生命周期 - 更新之后\r\n  beforeDestroy () {}, // 生命周期 - 销毁之前\r\n  destroyed () {}, // 生命周期 - 销毁完成\r\n  activated () {} // 如果页面有keep-alive缓存功能，这个函数会触发\r\n}\r\n</script>\r\n\r\n<style lang='less' scoped>\r\n</style>\r\n"]}]}