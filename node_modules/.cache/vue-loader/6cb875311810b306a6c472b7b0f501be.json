{"remainingRequest":"C:\\Users\\windows\\project\\ihrm\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\windows\\project\\ihrm\\src\\views\\setting\\index.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"C:\\Users\\windows\\project\\ihrm\\src\\views\\setting\\index.vue","mtime":1617245304591},{"path":"C:\\Users\\windows\\project\\ihrm\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\windows\\project\\ihrm\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\windows\\project\\ihrm\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\windows\\project\\ihrm\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\windows\\project\\ihrm\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouZWwtYWxlcnR7DQogIG1hcmdpbjoyMHB4IDA7DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwOA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/setting","sourcesContent":["<template>\r\n  <div class=\"dashboard-container\">\r\n    <div class=\"app-container\">\r\n      <el-card>\r\n        <!-- 标签页 -->\r\n        <el-tabs v-model='activeName' >\r\n          <!-- 角色设置 -->\r\n          <el-tab-pane label=\"角色设置\" name=\"first\" >\r\n            <el-row>\r\n              <el-button type=\"primary\" icon=\"el-icon-plus\" size='small' @click=\"showDialog = true\">\r\n                新增角色\r\n              </el-button>\r\n            </el-row>\r\n            <el-table  :data=\"list\">\r\n              <el-table-column  width=\"120\"  type=\"index\" label=\"序号\" align=\"center\"></el-table-column>\r\n              <el-table-column prop=\"name\" label=\"角色名称\" width=\"240\" align=\"center\"></el-table-column>    \r\n              <el-table-column prop=\"description\" label=\"描述\" align=\"center\"></el-table-column>    \r\n              <el-table-column label=\"操作\" align=\"center\">\r\n                <template slot-scope=\"scoped\">\r\n                  <el-button type=\"success\" size=\"mini\" @click='assignPerm(scoped.row.id)'>分配权限</el-button>\r\n                  <el-button type=\"primary\" size=\"mini\" @click=\"editRole(scoped.row.id)\">编辑</el-button>\r\n                  <el-button type=\"danger\" size=\"mini\" @click=\"deleteRole(scoped.row.id)\">删除</el-button>\r\n                </template>\r\n              </el-table-column>    \r\n\r\n            </el-table>\r\n            <!-- 分页组件 -->\r\n            <el-row type='flex' justify=\"center\" style=\"height:60px\">\r\n              <el-pagination layout=\"prev, pager, next\" :total=\"page.total\"  :page-size=\"page.pagesize\" :current-page=\"page.page\" @current-change=\"handleCurrentChange\"></el-pagination>\r\n            </el-row>\r\n            <!-- /分页组件 -->\r\n          </el-tab-pane>\r\n          <!-- 角色设置 -->\r\n          <!-- 公司信息 -->\r\n          <el-tab-pane label=\"公司信息\" name=\"second\">\r\n            <el-alert title=\"消息提示的文案\" type=\"info\"  :closable=\"false\"></el-alert>\r\n            <el-form label-width=\"120px\"  >\r\n              <el-form-item  label=\"企业名称\" style=\"width:400px\" >\r\n                <el-input disabled v-model=\"formDate.name\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"公司地址\" style=\"width:400px\">\r\n                <el-input disabled v-model=\"formDate.companyAddress\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"电话\" style=\"width:400px\">\r\n                <el-input disabled v-model=\"formDate.companyPhone\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"邮箱\" style=\"width:400px\">\r\n                <el-input disabled v-model=\"formDate.mailbox\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"备注\" style=\"width:400px\">\r\n                <el-input disabled v-model=\"formDate.remarks\"></el-input>\r\n              </el-form-item>\r\n            </el-form>\r\n          </el-tab-pane>\r\n          <!-- /公司信息 -->\r\n        </el-tabs>\r\n        <!-- /标签页 -->\r\n      </el-card>\r\n    </div>\r\n    <!-- 放置弹层组件 -->\r\n    <el-dialog :visible='showDialog' title=\"编辑部门\" @close=\"cancelEdit\">\r\n      <el-form label-width=\"120px\" :model=\"roleForm\" :rules=\"rules\" ref=\"roleForm\">\r\n        <el-form-item label=\"角色名称\" prop=\"name\" >\r\n          <el-input v-model=\"roleForm.name\" ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"角色描述\">\r\n          <el-input v-model=\"roleForm.description\"></el-input>\r\n        </el-form-item>\r\n        <el-row type='flex' justify=\"center\">\r\n          <el-col :span=\"8\">\r\n            <el-button size=\"small\" type=\"info\" @click=\"cancelEdit\">取消</el-button>\r\n            <el-button size=\"small\" type=\"primary\" @click=\"btnOk\">确定</el-button>\r\n          </el-col>\r\n        </el-row>\r\n      </el-form>\r\n    </el-dialog>\r\n    <!-- /放置弹层组件 -->\r\n    <!-- 分配权限弹层 -->\r\n      <el-dialog title=\"分配权限\" :visible=\"showPermDialog\" @close=\"isCancel\">\r\n        <el-tree :data=\"permData\" :props=\"defaultProps\" default-expand-all show-checkbox :check-strictly=\"true\" node-key=\"id\" :default-checked-keys=\"selectCheck\" ref=\"permTree\"></el-tree>\r\n        <el-row slot=\"footer\" type=\"flex\" justify=\"center\">\r\n          <el-col :span=\"6\">\r\n            <el-button type=\"primary\" size=\"small\" @click=\"btnPermOk\">\r\n              确定\r\n            </el-button>\r\n            <el-button size=\"small\" @click=\"isCancel\">\r\n              取消\r\n            </el-button>\r\n          </el-col>\r\n        </el-row>\r\n      </el-dialog>\r\n      <!-- /分配权限弹层 -->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {getRoleList,getCompanyInfo,deleteRole,getRoleDetail,updateRole,addRole,assignPerm } from '@/api/setting'\r\nimport {mapGetters} from 'vuex'\r\nimport {getPermissionList} from '@/api/permission'\r\nimport {tranListToTreeData} from '@/utils/index'\r\nimport { assignRoles } from '@/api/employees'\r\nexport default {\r\n  data() {\r\n    return {\r\n      list: [],\r\n      page:{\r\n        page:1,\r\n        pagesize:2,\r\n        total:0 // 总数\r\n      },\r\n      activeName: 'first',\r\n      formDate: {\r\n        // 公司信息\r\n      },\r\n      showDialog: false,\r\n      roleForm:{\r\n        name:'',\r\n        description:''\r\n      },\r\n      rules: {\r\n        name:[\r\n          {required:true,message:'角色名称不能为空!',trigger:'blur'},\r\n        ]\r\n      },\r\n      permData: [],\r\n      defaultProps: {\r\n        label:'name'\r\n      },\r\n      showPermDialog: false,\r\n      roleId: null, //用来记录当前用来分配权限的id\r\n      selectCheck: [],\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters(['companyId'])\r\n  },\r\n  created() {\r\n    this.getRolesList()\r\n    this.getCompanyInfo()\r\n  },\r\n  methods: {\r\n    async getRolesList() {\r\n      const {total,rows}= await getRoleList(this.page)\r\n      this.list = rows\r\n      this.page.total = total\r\n    },\r\n    /* 分页 */\r\n    handleCurrentChange (newPage) {\r\n      this.page.page = newPage\r\n      this.getRolesList()\r\n    },\r\n    async getCompanyInfo () {\r\n      this.formDate = await getCompanyInfo(this.companyId)\r\n    },\r\n    /* 删除角色 */\r\n    async deleteRole(id) {\r\n      this.$confirm('此操作将永久删除该角色, 是否继续?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then( async () => {\r\n          await deleteRole(id)\r\n          // 重新加载数据\r\n          this.getRolesList()\r\n          this.$message({\r\n            type: 'success',\r\n            message: '删除角色成功!'\r\n          });\r\n        }).catch(() => {\r\n          this.$message({\r\n            type: 'info',\r\n            message: '已取消删除'\r\n          })      \r\n        })\r\n    },\r\n    /* 编辑角色 */\r\n    async editRole(id) {\r\n\r\n      this.roleForm = await getRoleDetail(id)\r\n      this.showDialog = true\r\n    },\r\n    /* 提交表单 */\r\n    async btnOk() {\r\n      try {\r\n        await this.$refs.roleForm.validate()\r\n        if(this.roleForm.id) {\r\n          /* 编辑 */\r\n          await updateRole(this.roleForm)\r\n        } else {\r\n          // 新增角色\r\n          await addRole(this.roleForm)\r\n        }\r\n        this.getRolesList()\r\n        this.$message.success('角色数据更新成功!')\r\n        this.cancelEdit()\r\n      } catch (error) {\r\n      }\r\n    },\r\n    /* 取消编辑 */\r\n    cancelEdit() {\r\n      this.roleForm ={\r\n        name:'',\r\n        description:''\r\n      }\r\n      this.$refs.roleForm.resetFields()\r\n      this.showDialog = false\r\n    },\r\n    /* 分配权限 */\r\n    async assignPerm(id) {\r\n      this.permData = tranListToTreeData(await getPermissionList(),'0')\r\n      this.roleId = id\r\n      const {permIds} = await getRoleDetail(id)\r\n      this.selectCheck = permIds\r\n      this.showPermDialog = true\r\n    },\r\n    /* 提交数据 */\r\n    async btnPermOk() {\r\n      console.log('***调试中*******',this.$refs.permTree.getCheckedKeys())\r\n      const resule = await assignPerm({permIds:this.$refs.permTree.getCheckedKeys(),id:this.roleId})\r\n      this.$message.success('分配权限成功！')\r\n      this.isCancel()\r\n    },\r\n    /* 清除权限分配弹框 */\r\n    isCancel() {\r\n      this.selectCheck = []\r\n      this.showPermDialog = false\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.el-alert{\r\n  margin:20px 0;\r\n}\r\n</style>"]}]}