{"remainingRequest":"C:\\Users\\windows\\Project\\ihrm\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\windows\\Project\\ihrm\\src\\views\\departments\\components\\add-dept.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\windows\\Project\\ihrm\\src\\views\\departments\\components\\add-dept.vue","mtime":1616640037465},{"path":"C:\\Users\\windows\\Project\\ihrm\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\windows\\Project\\ihrm\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\windows\\Project\\ihrm\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\windows\\Project\\ihrm\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQovLyDov5nph4zlj6/ku6Xlr7zlhaXlhbbku5bmlofku7bvvIjmr5TlpoLvvJrnu4Tku7bvvIzlt6Xlhbdqc++8jOesrOS4ieaWueaPkuS7tmpz77yManNvbuaWh+S7tu+8jOWbvueJh+aWh+S7tuetieetie+8iQ0KaW1wb3J0IHthZGREZXBhcnRtZW50cywgZ2V0RGVwYXJ0bWVudHMsZ2V0RGVwYXJ0bWVudHNEZXRhaWx9IGZyb20gJ0AvYXBpL2RlcGFydG1lbnRzLmpzJw0KaW1wb3J0IHtnZXRFbXBsb3llZXNMaXN0fSBmcm9tICdAL2FwaS9lbXBsb3llZXMnDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICdhZGREZXB0JywNCiAgY29tcG9uZW50czoge30sDQogIG1vZGVsOiB7fSwgLy8g5a6a5LmJ5bGe5oCnDQogIHByb3BzOiB7DQogICAgc2hvd0RpYWxvZzogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlDQogICAgfSwNCiAgICB0cmVlTm9kZTogew0KICAgICAgdHlwZTogT2JqZWN0LA0KICAgICAgZGVmYXVsdDogbnVsbA0KICAgIH0NCiAgfSwNCiAgZGF0YSAoKSB7DQogICAgY29uc3QgY2hlY2tOYW1lUmVwZWF0ID0gIGFzeW5jKHJ1bGUsdmFsdWUsY2FsbGJhY2spID0+IHsNCiAgICAgIGNvbnN0IHsgZGVwdHMgfSA9IGF3YWl0IGdldERlcGFydG1lbnRzKCkNCiAgICAgIGNvbnN0IGlzUmVwZWF0ID0gZGVwdHMuZmlsdGVyKCBlbGVtZW50ID0+IHsNCiAgICAgICAgcmV0dXJuIGVsZW1lbnQucGlkID09dGhpcy50cmVlTm9kZS5waWQNCiAgICAgIH0pLnNvbWUoaXRlbSA9PiB7DQogICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT0gdmFsdWUgDQogICAgICB9KQ0KICAgICAgLy8gY29uc29sZS5sb2coJyoqKuS7o+eggeiwg+ivleS4rSoqKioqKicsIGlzUmVwZWF0KQ0KICAgICAgaXNSZXBlYXQgPyBjYWxsYmFjayhuZXcgRXJyb3IoYOWQjOe6p+mDqOmXqOS4i+W3suWtmOWcqCR7dmFsdWV96YOo6ZeoYCkpIDogY2FsbGJhY2soKQ0KICAgIH0NCiAgICBjb25zdCBjaGVja0NvZGVSZXBlYXQgPSBhc3luYyAocnVsZSx2YWx1ZSxjYWxsYmFjaykgPT4gew0KICAgICAgY29uc3QgeyBkZXB0cyB9ID0gYXdhaXQgZ2V0RGVwYXJ0bWVudHMoKQ0KICAgICAgY29uc3QgaXNSZXBlYXQgPSBkZXB0cy5zb21lKCBlbGVtZW50ID0+IHsNCiAgICAgICAgcmV0dXJuIGVsZW1lbnQuY29kZSA9PSB2YWx1ZSAmJiB2YWx1ZQ0KICAgICAgfSkNCiAgICAgIGlzUmVwZWF0ID8gY2FsbGJhY2sobmV3IEVycm9yKGAke3ZhbHVlfemDqOmXqOe8lueggemHjeWkjWApKSA6IGNhbGxiYWNrKCkNCiAgICB9DQogICAgcmV0dXJuIHsNCiAgICAgIGZvcm1EYXRlOiB7DQogICAgICAgIG5hbWU6JycsDQogICAgICAgIGNvZGU6JycsDQogICAgICAgIG1hbmFnZXI6ICcnLA0KICAgICAgICBpbnRyb2R1Y2U6IiINCiAgICAgIH0sDQogICAgICBydWxlczogew0KICAgICAgICBuYW1lOiBbDQogICAgICAgICAge3JlcXVpcmVkOnRydWUsIG1lc3NhZ2U6J+mDqOmXqOWQjeensOS4jeiDveS4uuepuu+8gScsdHJpZ2dlcjonYmx1cid9LA0KICAgICAgICAgIHttaW46MSxtYXg6NTAsbWVzc2FnZTon6ZW/5bqm5b+F6aG75ZyoMS0xMDDkuKrlrZfnrKbkuYvpl7QnLHRyaWdnZXI6J2JsdXInfSwNCiAgICAgICAgICB7dHJpZ2dlcjonYmx1cicsdmFsaWRhdGU6Y2hlY2tOYW1lUmVwZWF0fQ0KICAgICAgICBdLA0KICAgICAgICBjb2RlOiBbDQogICAgICAgICAge3JlcXVpcmVkOnRydWUsIG1lc3NhZ2U6J+mDqOmXqOe8lueggeS4jeiDveS4uuepuu+8gScsdHJpZ2dlcjonYmx1cid9LA0KICAgICAgICAgIHttaW46MSxtYXg6NTAsbWVzc2FnZTon6ZW/5bqm5b+F6aG75ZyoMS0xMDDkuKrlrZfnrKbkuYvpl7QnLHRyaWdnZXI6J2JsdXInfSwNCiAgICAgICAgICB7dHJpZ2dlcjonYmx1cicsdmFsaWRhdGU6Y2hlY2tDb2RlUmVwZWF0fQ0KICAgICAgICBdLA0KICAgICAgICBtYW5hZ2VyOiBbDQogICAgICAgICAge3JlcXVpcmVkOnRydWUsIG1lc3NhZ2U6J+mDqOmXqOeuoeeQhuWRmOS4jeiDveS4uuepuu+8gScsdHJpZ2dlcjonYmx1cid9LA0KICAgICAgICBdLA0KICAgICAgICBpbnRyb2R1Y2U6IFsNCiAgICAgICAgICB7cmVxdWlyZWQ6dHJ1ZSwgbWVzc2FnZTon6YOo6Zeo5LuL57uN5LiN6IO95Li656m677yBJyx0cmlnZ2VyOidibHVyJ30sDQogICAgICAgICAge21pbjoxLG1heDoxMDAsbWVzc2FnZTon6ZW/5bqm5b+F6aG75ZyoMS0zMDDkuKrlrZfnrKbkuYvpl7QnLHRyaWdnZXI6J2JsdXInfQ0KICAgICAgICBdDQogICAgICB9LA0KICAgICAgcGVvcGxlczpbXQ0KICAgIH0NCiAgfSwNCiAgYmVmb3JlQ3JlYXRlICgpIHt9LCAvLyDnlJ/lkb3lkajmnJ8gLSDliJvlu7rkuYvliY0NCiAgY3JlYXRlZCAoKSB7fSwgLy8g55Sf5ZG95ZGo5pyfIC0g5Yib5bu65a6M5oiQ77yI5Y+v5Lul6K6/6Zeu5b2T5YmNdGhpc+WunuS+i++8iQ0KICBiZWZvcmVNb3VudCAoKSB7fSwgLy8g55Sf5ZG95ZGo5pyfIC0g5oyC6L295LmL5YmNDQogIG1vdW50ZWQgKCkge30sIC8vIOeUn+WRveWRqOacnyAtIOaMgui9veWujOaIkO+8iOWPr+S7peiuv+mXrkRPTeWFg+e0oO+8iQ0KICBjb21wdXRlZDogew0KICAgIHNob3dUaXRsZSgpIHsNCiAgICAgIHRoaXMuZm9ybURhdGUuaWQgPyAn5paw5aKe6YOo6ZeoJyA6ICfnvJbovpHpg6jpl6gnDQogICAgfQ0KICB9LCAvLyDorqHnrpflsZ7mgKfvvIzkvJrnm5HlkKzkvp3otZblsZ7mgKflgLzpmo/kuYvlj5jljJYNCiAgd2F0Y2g6IHt9LCAvLyDnm5HmjqdkYXRh5Lit55qE5pWw5o2u5Y+Y5YyWDQogIG1ldGhvZHM6IHsNCiAgICAvKiDojrflj5botJ/otKPkurrmlbDmja7liJfooaggKi8NCiAgICBhc3luYyBnZXRFbXBsb3llZXNMaXN0KCkgew0KICAgICAgdGhpcy5wZW9wbGVzID0gYXdhaXQgZ2V0RW1wbG95ZWVzTGlzdCgpDQogICAgfSwNCiAgICAvKiDlhajlsYDmoKHpqozovpPlhaXmoYYgKi8NCiAgICBidG5PaygpIHsNCiAgICAgIHRoaXMuJHJlZnMuZGVwdEZvcm0udmFsaWRhdGUoYXN5bmMgdmFsaWRhdGUgPT4gew0KICAgICAgICBpZih2YWxpZGF0ZSkgew0KICAgICAgICAgIGF3YWl0IGFkZERlcGFydG1lbnRzKHsuLi50aGlzLmZvcm1EYXRlLHBpZDp0aGlzLnRyZWVOb2RlLmlkfSkNCiAgICAgICAgICAvLyDmuIXpmaTovpPlhaXmoYblhoXlrrkNCiAgICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6c2hvd0RpYWxvZycsZmFsc2UpDQogICAgICAgICAgdGhpcy4kZW1pdCgnYWRkRGVwdHMnKQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgYnRuQ2FuY2VsICgpIHsNCiAgICAgIHRoaXMuJHJlZnMuZGVwdEZvcm0udmFsaWRhdGVGaWVsZCgpDQogICAgICB0aGlzLmZvcm1EYXRlID17DQogICAgICAgIG5hbWU6JycsDQogICAgICAgIGNvZGU6JycsDQogICAgICAgIG1hbmFnZXI6ICcnLA0KICAgICAgICBpbnRyb2R1Y2U6IiINCiAgICAgIH0NCiAgICAgIHRoaXMuJHJlZnMuZGVwdEZvcm0ucmVzZXRGaWVsZHMoKQ0KICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOnNob3dEaWFsb2cnLGZhbHNlKQ0KICAgIH0sDQogICAgLyog6I635Y+W5b2T5YmN6YOo6Zeo6K+m5oOFICovDQogICAgYXN5bmMgZ2V0RGVwYXJ0bWVudHNEZXRhaWwoaWQpIHsNCiAgICAgIHRoaXMuZm9ybURhdGUgPSBhd2FpdCBnZXREZXBhcnRtZW50c0RldGFpbChpZCkNCiAgICB9IA0KICB9LCAvLyDmlrnms5Xpm4blkIgNCiAgYmVmb3JlVXBkYXRlICgpIHt9LCAvLyDnlJ/lkb3lkajmnJ8gLSDmm7TmlrDkuYvliY0NCiAgdXBkYXRlZCAoKSB7fSwgLy8g55Sf5ZG95ZGo5pyfIC0g5pu05paw5LmL5ZCODQogIGJlZm9yZURlc3Ryb3kgKCkge30sIC8vIOeUn+WRveWRqOacnyAtIOmUgOavgeS5i+WJjQ0KICBkZXN0cm95ZWQgKCkge30sIC8vIOeUn+WRveWRqOacnyAtIOmUgOavgeWujOaIkA0KICBhY3RpdmF0ZWQgKCkge30gLy8g5aaC5p6c6aG16Z2i5pyJa2VlcC1hbGl2Zee8k+WtmOWKn+iDve+8jOi/meS4quWHveaVsOS8muinpuWPkQ0KfQ0K"},{"version":3,"sources":["add-dept.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add-dept.vue","sourceRoot":"src/views/departments/components","sourcesContent":["<template>\r\n  <el-dialog :title=\"showTitle\" :visible=\"showDialog\" width=\"30%\" @close=\"btnCancel\">  \r\n    <el-form  label-width=\"100px\" :model=\"formDate\" :rules=\"rules\" ref=\"deptForm\">\r\n      <el-form-item label=\"部门名称\" prop=\"name\">\r\n        <el-input v-model=\"formDate.name\" placeholder=\"1-50字符\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"部门编码\"  prop=\"code\">\r\n        <el-input v-model=\"formDate.code\" placeholder=\"1-50字符\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"部门负责人\"  prop=\"manager\">\r\n        <el-select v-model=\"formDate.manager\" placeholder=\"请选择\" style=\"width: 100%;\" @focus=\"getEmployeesList\">\r\n          <el-option v-for=\"item in peoples\" :key=\"item.id\" :label=\"item.username\" :value=\"item.username\"></el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"部门介绍\"  prop=\"introduce\">\r\n         <el-input type=\"textarea\" v-model=\"formDate.introduce\" placeholder=\"1-300字符\" rows=\"3\"></el-input>\r\n      </el-form-item>\r\n    </el-form>\r\n    <!-- 确定提交 -->\r\n    <el-row type=\"flex\" justify=\"center\" slot='footer'>\r\n      <el-col :span=\"6\">\r\n        <el-button  size=\"small\" @click=\"btnCancel\">取消</el-button>\r\n        <el-button  size=\"small\" type=\"primary\" @click=\"btnOk\">确定</el-button>\r\n      </el-col>\r\n    </el-row>\r\n    <!-- /确定提交 -->\r\n  </el-dialog>\r\n</template>\r\n\r\n<script>\r\n// 这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）\r\nimport {addDepartments, getDepartments,getDepartmentsDetail} from '@/api/departments.js'\r\nimport {getEmployeesList} from '@/api/employees'\r\nexport default {\r\n  name: 'addDept',\r\n  components: {},\r\n  model: {}, // 定义属性\r\n  props: {\r\n    showDialog: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    treeNode: {\r\n      type: Object,\r\n      default: null\r\n    }\r\n  },\r\n  data () {\r\n    const checkNameRepeat =  async(rule,value,callback) => {\r\n      const { depts } = await getDepartments()\r\n      const isRepeat = depts.filter( element => {\r\n        return element.pid ==this.treeNode.pid\r\n      }).some(item => {\r\n        return item.name == value \r\n      })\r\n      // console.log('***代码调试中******', isRepeat)\r\n      isRepeat ? callback(new Error(`同级部门下已存在${value}部门`)) : callback()\r\n    }\r\n    const checkCodeRepeat = async (rule,value,callback) => {\r\n      const { depts } = await getDepartments()\r\n      const isRepeat = depts.some( element => {\r\n        return element.code == value && value\r\n      })\r\n      isRepeat ? callback(new Error(`${value}部门编码重复`)) : callback()\r\n    }\r\n    return {\r\n      formDate: {\r\n        name:'',\r\n        code:'',\r\n        manager: '',\r\n        introduce:\"\"\r\n      },\r\n      rules: {\r\n        name: [\r\n          {required:true, message:'部门名称不能为空！',trigger:'blur'},\r\n          {min:1,max:50,message:'长度必须在1-100个字符之间',trigger:'blur'},\r\n          {trigger:'blur',validate:checkNameRepeat}\r\n        ],\r\n        code: [\r\n          {required:true, message:'部门编码不能为空！',trigger:'blur'},\r\n          {min:1,max:50,message:'长度必须在1-100个字符之间',trigger:'blur'},\r\n          {trigger:'blur',validate:checkCodeRepeat}\r\n        ],\r\n        manager: [\r\n          {required:true, message:'部门管理员不能为空！',trigger:'blur'},\r\n        ],\r\n        introduce: [\r\n          {required:true, message:'部门介绍不能为空！',trigger:'blur'},\r\n          {min:1,max:100,message:'长度必须在1-300个字符之间',trigger:'blur'}\r\n        ]\r\n      },\r\n      peoples:[]\r\n    }\r\n  },\r\n  beforeCreate () {}, // 生命周期 - 创建之前\r\n  created () {}, // 生命周期 - 创建完成（可以访问当前this实例）\r\n  beforeMount () {}, // 生命周期 - 挂载之前\r\n  mounted () {}, // 生命周期 - 挂载完成（可以访问DOM元素）\r\n  computed: {\r\n    showTitle() {\r\n      this.formDate.id ? '新增部门' : '编辑部门'\r\n    }\r\n  }, // 计算属性，会监听依赖属性值随之变化\r\n  watch: {}, // 监控data中的数据变化\r\n  methods: {\r\n    /* 获取负责人数据列表 */\r\n    async getEmployeesList() {\r\n      this.peoples = await getEmployeesList()\r\n    },\r\n    /* 全局校验输入框 */\r\n    btnOk() {\r\n      this.$refs.deptForm.validate(async validate => {\r\n        if(validate) {\r\n          await addDepartments({...this.formDate,pid:this.treeNode.id})\r\n          // 清除输入框内容\r\n          this.$emit('update:showDialog',false)\r\n          this.$emit('addDepts')\r\n        }\r\n      })\r\n    },\r\n    btnCancel () {\r\n      this.$refs.deptForm.validateField()\r\n      this.formDate ={\r\n        name:'',\r\n        code:'',\r\n        manager: '',\r\n        introduce:\"\"\r\n      }\r\n      this.$refs.deptForm.resetFields()\r\n      this.$emit('update:showDialog',false)\r\n    },\r\n    /* 获取当前部门详情 */\r\n    async getDepartmentsDetail(id) {\r\n      this.formDate = await getDepartmentsDetail(id)\r\n    } \r\n  }, // 方法集合\r\n  beforeUpdate () {}, // 生命周期 - 更新之前\r\n  updated () {}, // 生命周期 - 更新之后\r\n  beforeDestroy () {}, // 生命周期 - 销毁之前\r\n  destroyed () {}, // 生命周期 - 销毁完成\r\n  activated () {} // 如果页面有keep-alive缓存功能，这个函数会触发\r\n}\r\n</script>\r\n\r\n<style lang='less' scoped>\r\n</style>\r\n"]}]}